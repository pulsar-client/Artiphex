-- Delta Compatible Animation Fix
-- Prevents looping and fixes character freeze bugs.

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local replacementAnimations = {
    ["10480796021"] = {Id = "rbxassetid://13498249507", Speed = 1.0},
    ["10491993682"] = {Id = "rbxassetid://17838619895", Speed = 1.0}, -- Freeze bug fix applied
    ["10480793962"] = {Id = "rbxassetid://13498239823", Speed = 1.0}
}

local function setupCharacter(character)
    local humanoid = character:WaitForChild("Humanoid")
    -- Use Animator for better stability on Delta
    local animator = humanoid:WaitForChild("Animator") 

    local function onAnimationPlayed(animationTrack)
        -- Safety check
        if not animationTrack.Animation then return end

        local animationId = animationTrack.Animation.AnimationId:match("%d+")
        local replacementData = replacementAnimations[animationId]

        if replacementData then
            -- Stop the original animation immediately
            animationTrack:Stop()

            -- Create the new animation
            local newAnimation = Instance.new("Animation")
            newAnimation.AnimationId = replacementData.Id
            
            -- Load onto the Animator
            local newTrack = animator:LoadAnimation(newAnimation)
            
            -- CRITICAL FIXES:
            newTrack.Looped = false -- Ensure it runs only once
            newTrack.Priority = Enum.AnimationPriority.Action -- Ensure it overrides movement but doesn't get stuck
            
            newTrack:Play()
            newTrack:AdjustSpeed(replacementData.Speed)

            -- Cleanup to ensure movement is restored
            newTrack.Stopped:Connect(function()
                newTrack:Destroy() -- Removes the track completely when done
            end)
        end
    end

    humanoid.AnimationPlayed:Connect(onAnimationPlayed)
end

-- Persistent Connection
player.CharacterAdded:Connect(setupCharacter)

if player.Character then
    setupCharacter(player.Character)
endend)
