-- // === SETTINGS === \\ --

local DeleteAllAccessories = "Yes" -- "Yes" or "No"
local ForcePantsID = 1102371782          
local ForceShirtID = 1102370717   -- âœ… Classic or UGC shirt ID (numbers only)

-- Accessories / Faces
local face = 0
local hair = 0
local AnyAccessory1 = 18169009524
local AnyAccessory2 = 0
local AnyAccessory3 = 0
local AnyAccessory4 = 0
local AnyAccessory5 = 0
local AnyAccessory6 = 0
local AnyAccessory7 = 0
local AnyAccessory8 = 0
local AnyAccessory9 = 0
local AnyAccessory10 = 0

-- R6 Mesh Replacements
local Head = 0
local RightArm = 0
local LeftArm = 0
local Torso = 0
local RightLeg = 0
local LeftLeg = 0

-- // === SERVICES === \\ --

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
if not LocalPlayer then return end

-- // === HELPERS === \\ --

local function weldAccessory(acc, char)
	if not acc or not acc:IsA("Accessory") or not acc:FindFirstChild("Handle") then return end
	for _, c in ipairs(char:GetDescendants()) do
		for _, f in ipairs(acc.Handle:GetChildren()) do
			if f:IsA("Attachment") and c:FindFirstChild(f.Name) and c[f.Name]:IsA("Attachment") then
				local w = Instance.new("Weld")
				w.Name = "AccessoryWeld"
				w.Part0 = acc.Handle
				w.Part1 = c
				w.C0 = f.CFrame
				w.C1 = c[f.Name].CFrame
				w.Parent = acc.Handle
				return
			end
		end
	end
end

local function loadAccessory(id, char)
	if id == 0 then return end
	local obj = game:GetObjects("rbxassetid://" .. id)[1]
	if not obj then return end
	if obj:IsA("Model") and not obj:IsA("Accessory") then
		for _, v in ipairs(obj:GetDescendants()) do
			if v:IsA("Accessory") then
				v.Parent = char
				weldAccessory(v, char)
			end
		end
		obj:Destroy()
	elseif obj:IsA("Accessory") then
		obj.Parent = char
		weldAccessory(obj, char)
	else
		obj:Destroy()
	end
end

local function loadHeadReplacement(id, char)
	if id == 0 then return end
	local m = game:GetObjects("rbxassetid://" .. id)[1]
	if m then
		local acc = m:IsA("Accessory") and m or m:FindFirstChildWhichIsA("Accessory", true)
		if acc and acc:FindFirstChild("Handle") then
			char.Head.Transparency = 1
			if char.Head:FindFirstChild("face") then
				char.Head.face.Transparency = 1
			end
			acc.Parent = char
			weldAccessory(acc, char)
		end
		m:Destroy()
	end
end

local function replaceMesh(id, limbName, char)
	if id == 0 then return end
	local m = game:GetObjects("rbxassetid://" .. id)[1]
	if not m then return end
	local acc = m:IsA("Accessory") and m or m:FindFirstChildWhichIsA("Accessory", true)
	if acc and acc:FindFirstChild("Handle") then
		local mesh = acc.Handle:FindFirstChildOfClass("SpecialMesh")
		if mesh and char:FindFirstChild(limbName) then
			local limb = char[limbName]
			local old = limb:FindFirstChildOfClass("SpecialMesh")
			if old then old:Destroy() end
			local me = Instance.new("SpecialMesh")
			me.MeshId = mesh.MeshId
			me.TextureId = mesh.TextureId
			me.Parent = limb
		end
	end
	m:Destroy()
end

-- âœ… Supports classic & UGC pants
local function forceAnyPants(char)
	if ForcePantsID == 0 then return end
	local success, obj = pcall(function()
		return game:GetObjects("rbxassetid://" .. ForcePantsID)[1]
	end)
	if not success or not obj then return end

	-- Classic pants
	local classicPants
	if obj:IsA("Pants") then
		classicPants = obj
	elseif obj:IsA("Model") then
		classicPants = obj:FindFirstChildWhichIsA("Pants", true)
	end

	if classicPants then
		local old = char:FindFirstChildOfClass("Pants")
		if old then old:Destroy() end
		local p = Instance.new("Pants")
		p.Name = "ForcedPants"
		p.PantsTemplate = classicPants.PantsTemplate
		p.Parent = char
		obj:Destroy()
		return
	end

	-- UGC Layered pants
	local ugcAccessory
	if obj:IsA("Accessory") then
		ugcAccessory = obj
	elseif obj:IsA("Model") then
		ugcAccessory = obj:FindFirstChildWhichIsA("Accessory", true)
	end

	if ugcAccessory then
		ugcAccessory.Parent = char
		weldAccessory(ugcAccessory, char)
	end
end

-- âœ… Supports classic & UGC shirts
local function forceAnyShirt(char)
	if ForceShirtID == 0 then return end
	local success, obj = pcall(function()
		return game:GetObjects("rbxassetid://" .. ForceShirtID)[1]
	end)
	if not success or not obj then return end

	-- Classic shirt
	local classicShirt
	if obj:IsA("Shirt") then
		classicShirt = obj
	elseif obj:IsA("Model") then
		classicShirt = obj:FindFirstChildWhichIsA("Shirt", true)
	end

	if classicShirt then
		local old = char:FindFirstChildOfClass("Shirt")
		if old then old:Destroy() end
		local s = Instance.new("Shirt")
		s.Name = "ForcedShirt"
		s.ShirtTemplate = classicShirt.ShirtTemplate
		s.Parent = char
		obj:Destroy()
		return
	end

	-- UGC Layered shirt
	local ugcAccessory
	if obj:IsA("Accessory") then
		ugcAccessory = obj
	elseif obj:IsA("Model") then
		ugcAccessory = obj:FindFirstChildWhichIsA("Accessory", true)
	end

	if ugcAccessory then
		ugcAccessory.Parent = char
		weldAccessory(ugcAccessory, char)
	end
end

-- // === CHARACTER SETUP === \\ --

local function setupCharacter(char)
	if DeleteAllAccessories == "Yes" then
		for _, d in ipairs(char:GetDescendants()) do
			if d:IsA("Accessory") then d:Destroy() end
		end
	end

	if face ~= 0 then
		local f = game:GetObjects("rbxassetid://" .. face)[1]
		if f and f:FindFirstChild("face") and char.Head:FindFirstChild("face") then
			char.Head.face.Texture = f.face.Texture
		end
		if f then f:Destroy() end
	end

	loadAccessory(hair, char)
	loadAccessory(AnyAccessory1, char)
	loadAccessory(AnyAccessory2, char)
	loadAccessory(AnyAccessory3, char)
	loadAccessory(AnyAccessory4, char)
	loadAccessory(AnyAccessory5, char)
	loadAccessory(AnyAccessory6, char)
	loadAccessory(AnyAccessory7, char)
	loadAccessory(AnyAccessory8, char)
	loadAccessory(AnyAccessory9, char)
	loadAccessory(AnyAccessory10, char)

	loadHeadReplacement(Head, char)

	replaceMesh(RightArm, "Right Arm", char)
	replaceMesh(LeftArm, "Left Arm", char)
	replaceMesh(Torso, "Torso", char)
	replaceMesh(RightLeg, "Right Leg", char)
	replaceMesh(LeftLeg, "Left Leg", char)

	forceAnyPants(char)
	forceAnyShirt(char)
end

-- // === CONNECT === \\ --

LocalPlayer.CharacterAdded:Connect(function(char)
	char:WaitForChild("Humanoid")
	setupCharacter(char)
end)

if LocalPlayer.Character then
	setupCharacter(LocalPlayer.Character)
end
